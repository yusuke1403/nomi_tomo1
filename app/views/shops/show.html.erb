<%= render "shared/header_show" %>

<div class='shop-name'>
  <%= @shop.name %>
</div>
<div class='shop-img'>
  <% @shop.images.each do |image| %>
    <%= image_tag image.src%>
  <% end %>
</div>

<div class='shop'>
  <%= @shop.tel %>
</div>

<div class='shop-adress'>
  <%= @shop.address %>
</div>

<div class='shop-adress'>
  <%= @shop.category %>
</div>

<div class='shop-adress'>
  <%= @shop.open_time %>
</div>
<div class='shop-adress'>
  <%= @shop.holiday %>
</div>
<div class='shop-adress'>
  <%= @shop.pr_short %>
</div>
<div class='shop-adress'>
  <%= @shop.pr_long %>
</div>
<div class='shop-adress'>
  <%= @shop.url %>
</div>

<%= link_to 'チャットルームへ', shop_rooms_path(@shop), class: "chat-room" %>

<% if !Favorite.exists?(user_id:current_user.id,shop_id:@shop.id) %>
  <%= link_to "お気に入り",shop_favorites_path(@shop),method: :post %>
<% else %>
  <%= link_to "お気に入り解除",shop_favorites_path(@shop),method: :delete %>
<% end %>

<h2>gmap</h2>

<div id='map'>
</div>

<style>
#map{
  height: 700px;
  width: 1000px;
}
</style>

<script>
  // 現在地取得処理
  function initMap() {
    // Geolocation APIに対応している
    if (navigator.geolocation) {
      // 現在地を取得
      navigator.geolocation.getCurrentPosition(
        // 取得成功した場合
        function(position) {
          // 緯度・経度を変数に格納
          const mapLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
          // マップオプションを変数に格納
          const mapOptions = {
            zoom : 14,          // 拡大倍率
            center : mapLatLng  // 緯度・経度
          };
          const test ={lat: <%= @shop.latitude %>, lng: <%= @shop.longitude %>};
          const contentString = '住所：<%= @shop.address %>';
          // マップオブジェクト作成
          const map = new google.maps.Map(
            document.getElementById("map"), // マップを表示する要素
            mapOptions         // マップオプション
          );
          // マップにマーカーを表示する
          const marker = new google.maps.Marker({
            map : map,             // 対象の地図オブジェクト
            position : mapLatLng,   // 緯度・経度
            icon: {
            url: ' http://maps.google.co.jp/mapfiles/ms/icons/red-pushpin.png', //アイコンのURL
            scaledSize: new google.maps.Size(40, 40) //サイズ
            }
          });
          const marker_shop = new google.maps.Marker({
            position:test,
            map: map,
            title: contentString,
            icon: {
            url: ' http://maps.google.com/mapfiles/kml/pal2/icon19.png', //アイコンのURL
            scaledSize: new google.maps.Size(40, 40) //サイズ
            }
          });
        },
        // 取得失敗した場合
        function(error) {
          // エラーメッセージを表示
          switch(error.code) {
            case 1: // PERMISSION_DENIED
              alert("位置情報の利用が許可されていません");
              break;
            case 2: // POSITION_UNAVAILABLE
              alert("現在位置が取得できませんでした");
              break;
            case 3: // TIMEOUT
              alert("タイムアウトになりました");
              break;
            default:
              alert("その他のエラー(エラーコード:"+error.code+")");
              break;
          }
        }
      );
    // Geolocation APIに対応していない
    } else {
      alert("この端末では位置情報が取得できません");
    }
  }
</script>
